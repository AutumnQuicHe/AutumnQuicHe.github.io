<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>10.2 立即关闭 on Autumn Navigation</title>
    <link>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/</link>
    <description>Recent content in 10.2 立即关闭 on Autumn Navigation</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>cn</language><atom:link href="/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>10.2.1 连接的关闭状态</title>
      <link>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.1_Closing_Connection_State/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.1_Closing_Connection_State/</guid>
      <description>终端发起立即关闭后进入关闭状态。
在关闭状态下，终端仅保留足够用于创建包含连接关闭帧的数据包和用于区分数据包是否属于此条已关闭连接的信息。处于关闭状态的终端发送包含连接关闭帧的数据包来响应任何属于这条连接的传入数据包。
终端应该限制它在关闭状态下创建数据包的速率。比如，终端可以在响应接收到的数据包前等待足够的数据包或时间，且等待的数据包数量或时间长短是逐渐增长的。
终端选择的连接ID和QUIC版本是区分数据包是否属于一条关闭状态的连接的充分信息；终端可以丢弃所有其他连接状态数据。处于关闭状态的终端没有必要处理任何接收到的帧。终端可以为传入数据包保留数据包保护密钥用于读取和处理连接关闭帧。
当进入关闭状态时，终端可以丢弃数据包保护密钥，然后在响应任何接收到的UDP数据报时都发送包含连接关闭帧的数据包。然而，丢弃了数据包保护密钥的终端没有能力区分并丢弃不合法的数据包。为了避免被用于放大攻击，这样的终端必须限制它发出的数据包尺寸总和不超过它接收到的且属于这条连接的数据包尺寸总和的三倍。为了最小化终端为关闭状态的连接所维护的状态数据，终端可以在响应任何接收到的数据包时发送完全相同的数据包。
 注意：允许在关闭状态下重传完全相同的数据包是“每个数据包都必须使用新的数据包号”要求的一个特例，详见第12.3章。发送新的数据包号主要是用于丢包恢复和拥塞控制，但这两者都和一个已关闭的连接关系不大。重传这最后一个数据包需要的状态数据更少。
 当处于关闭状态时，终端可能从新的源地址接收到数据包，这可能是连接迁移的结果；详见第9章。处于关闭状态的终端必须要么丢弃从未经验证的地址接收到的数据包，要么限制它发向未经验证的地址的数据包尺寸总和，使其小于它从那个地址接收到的数据包的尺寸总和。
处于关闭状态的终端不应处理密钥更新（详见《QUIC-TLS》的第6章）。密钥更新可能阻止终端从关闭状态转移到排空状态，因为终端将失去处理后续接收到的数据包的能力，但这没有什么影响。</description>
    </item>
    
    <item>
      <title>10.2.2 连接的排空状态</title>
      <link>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.2_Draining_Connection_State/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.2_Draining_Connection_State/</guid>
      <description>一旦终端接收到连接关闭帧，他就会进入排空状态，这表明对端已处于关闭或排空状态。虽然在其他方面都和关闭状态一致，不过处于排空状态的终端必须不发送任何数据包。一旦连接处于排空状态，就没有必要再保留数据包保护密钥了。
接收到连接关闭帧的终端可以再进入排空状态前发送一个包含连接关闭帧的数据包，并且，如若合适，使用NO_ERROR（无错误）代码。除此之外，终端必须不发送更多数据包。不这么做会导致两个终端间保持不断交换连接关闭帧的状态，直到其中一个终端退出关闭状态。
如果终端接收到了连接关闭帧，那么它可以从关闭状态进入排空状态，这表明对端也处于关闭或排空状态。在这种情况下，排空状态会在原来关闭状态应该结束时结束。换句话说，终端使用相同的状态结束时机但是不再在这条连接上传输数据包。</description>
    </item>
    
    <item>
      <title>10.2.3 在握手期间立即关闭</title>
      <link>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.3_Immediate_Close_during_the_Handshake/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/RFC9000_Chinese_Translation/Connection_Termination/Immediate_Close/10.2.3_Immediate_Close_during_the_Handshake/</guid>
      <description>发送连接关闭帧时，要确保对端会处理这个帧。通常来说，这意味着将这个帧放到具有最高级别的数据包保护的数据包中发送，以避免数据包被丢弃。在握手确认后（详见《QUIC-TLS》的第4.1.2章），终端必须在1-RTT数据包中发送任何连接关闭帧。然而，在确认握手前，更高级的数据包保护密钥有可能在对端那还不可用，所以可以使用具有较低数据包保护级别的数据包多发送一个连接关闭帧。具体来说：
  客户端总是知道服务器有没有握手密钥（详见第17.2.2.1章），但是服务器不确定客户端有没有握手密钥。在这种条件下，服务器应该用握手数据包和初始数据包各发送一个连接关闭帧来确保它们中的至少一个是客户端可以处理的。
  在0-RTT数据包中发送连接关闭帧的客户端不能确信服务器会同意0-RTT的使用。用初始数据包发送连接关闭帧使得服务器更有可能接收到关闭的信号，哪怕应用错误码可能不会被接收到。
  在确认握手前，对端可能无法处理1-RTT数据包，所以终端应该用握手数据包和1-RTT数据包各发送一个连接关闭帧。服务器则应该用初始数据包发送连接关闭帧。
  用初始数据包或握手数据包发送类型为0x1d的连接关闭帧会暴露应用状态或被用于更改应用状态。用初始数据包或握手数据包发送时，必须将类型为0x1d的连接关闭帧替换为类型为0x1c的连接关闭帧。否则，有关应用状态的信息可能被泄露。终端在转换连接关闭帧的类型到0x1c时必须清除原因语句字段的值，并且应该使用APPLICATION_ERROR（应用错误）代码。
用不同数据包类型发送的连接关闭帧可以被合并至单个UDP数据报中；详见第12.2章。
终端可以用初始数据包发送连接关闭帧。这时可能是在响应接收自初始数据包或握手数据包的未通过认证的信息。这样的立即关闭行为可能将合法的连接暴露在拒绝服务攻击之下。QUIC对于握手过程中来自路径上设备的攻击并不提供防御措施；详见第21.2章。然而，如果牺牲发向合法对端的关于错误的反馈，并且终端直接丢弃不合法的数据包而不是用关闭连接帧终止连接，那么部分形式的拒绝服务攻击对于攻击者来说会变得更难实施。出于这个原因，如果在缺乏认证的数据包中检测出了错误，那么终端可以丢弃数据包而不是选择立即关闭。
尚未建立状态的终端，例如在初始数据包中检测到错误的服务器，并不会进入关闭状态。在发送连接关闭帧时，没有关于连接的状态的终端不会进入关闭或排空状态。</description>
    </item>
    
  </channel>
</rss>
